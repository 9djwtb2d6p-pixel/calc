<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grade Calc Ultra</title>
<style>
:root{
  --bg-dark:#0b0f14;
  --bg-light:#f4f4f9;
  --card-dark:#11141a;
  --card-light:#fff;
  --glass: rgba(255,255,255,0.05);
  --accent1:#6a7cff;
  --accent2:#3dd6c6;
  --good:#6fe3b6;
  --warn:#ffbe5b;
  --bad:#ff7d7d;
  --text-dark:#e8eef3;
  --text-light:#111;
  --muted-dark:#8a93a2;
  --muted-light:#555;
  --shadow-dark:0 10px 25px rgba(0,0,0,0.6);
  --shadow-light:0 10px 25px rgba(0,0,0,0.1);
  --transition:0.3s ease;
  font-family:"Inter","Segoe UI",Roboto,sans-serif;
}
body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:20px;
  background:var(--bg-dark);
  color:var(--text-dark);
  transition:background var(--transition), color var(--transition);
}
body.light{
  background:var(--bg-light);
  color:var(--text-light);
}
.container{
  width:100%;
  max-width:520px;
  background:var(--card-dark);
  border-radius:25px;
  padding:25px;
  box-shadow:var(--shadow-dark);
  display:flex;
  flex-direction:column;
  gap:20px;
  transition:all var(--transition);
  position:relative;
}
body.light .container{
  background:var(--card-light);
  box-shadow:var(--shadow-light);
}
h1{
  font-size:2.2rem;
  margin:0;
  background:linear-gradient(90deg,var(--accent1),var(--accent2));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-align:center;
}
.grades{display:flex;flex-direction:column;gap:12px;}
.grade-row{
  display:flex;
  flex-direction:column;
  gap:6px;
  cursor:grab;
  user-select:none;
  transition:all 0.25s ease;
  opacity:0;transform:scale(0.95);
}
.grade-row.show{opacity:1;transform:scale(1);}
.grade-row.dragging{opacity:0.6;transform:scale(1.03);box-shadow:0 14px 28px rgba(0,0,0,0.5);}
.grade-inputs{display:flex;gap:10px;width:100%;}
.grade-row input{flex:1;padding:12px 14px;border-radius:16px;border:1px dashed rgba(255,255,255,0.1);background:rgba(255,255,255,0.02);color:var(--text-dark);font-size:15px;transition:all 0.3s ease;}
body.light .grade-row input{color:var(--text-light);}
.grade-row input:focus{outline:none;border-color:var(--accent1);background:rgba(255,255,255,0.08);box-shadow:0 0 12px rgba(106,124,255,0.3);}
.remove-btn{padding:6px 12px;font-size:12px;background:var(--bad);color:#fff;border-radius:14px;border:none;cursor:pointer;transition:all 0.25s ease;}
.remove-btn:hover{transform:scale(1.08);opacity:0.85;}
.suggestion{font-size:12px;color:var(--muted-dark);}
body.light .suggestion{color:var(--muted-light);}
.grade-bar{width:100%;height:12px;border-radius:10px;background:rgba(255,255,255,0.05);overflow:hidden;transition:all 0.4s ease;}
.grade-bar-fill{height:100%;width:0%;border-radius:10px;transition:width 0.5s ease, background 0.4s ease;}
.result{text-align:center;padding:18px;border-radius:20px;background:var(--glass);border:1px solid rgba(255,255,255,0.06);box-shadow:0 10px 25px rgba(0,0,0,0.45);display:flex;flex-direction:column;gap:12px;transition:all 0.4s ease;}
.result .num{font-size:2.6rem;font-weight:700;background:linear-gradient(90deg,var(--accent1),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;transition:all 0.4s ease;}
.result .num.animate{animation:pulse 0.5s;}
@keyframes pulse{0%{transform:scale(1);}50%{transform:scale(1.15);}100%{transform:scale(1);}}
.result .letter{font-size:1.8rem;font-weight:700;}
.flex-row{display:flex;gap:10px;}
button.add-btn{flex:1;padding:10px;font-size:15px;border-radius:20px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#071027;font-weight:600;border:none;cursor:pointer;transition:all 0.25s ease;}
button.add-btn:hover{transform:scale(1.04);box-shadow:0 0 20px rgba(106,124,255,0.5);}
#settingsBtn{position:absolute;top:15px;right:15px;background:var(--accent2);color:#071027;border:none;padding:8px 10px;border-radius:14px;cursor:pointer;transition:all 0.25s ease;}
#settingsBtn:hover{transform:scale(1.1);}
#settingsPanel{position:absolute;top:50px;right:15px;background:var(--card-dark);padding:15px;border-radius:18px;box-shadow:0 10px 25px rgba(0,0,0,0.5);display:none;flex-direction:column;gap:12px;min-width:180px;z-index:10;transition:all 0.3s ease;}
body.light #settingsPanel{background:var(--card-light);}
#settingsPanel button{padding:8px 12px;border-radius:16px;border:none;cursor:pointer;transition:all 0.25s ease;font-size:14px;}
#settingsPanel button:hover{transform:scale(1.05);}
input[type="file"]{display:none;}
@media(max-width:500px){.container{padding:20px;}h1{font-size:2rem;}.grade-row input{font-size:14px;padding:10px 12px;}.remove-btn{padding:5px 10px;font-size:11px;}.result .num{font-size:2.2rem;}.result .letter{font-size:1.5rem;}button.add-btn{font-size:14px;padding:10px;}}
</style>
</head>
<body>
<div class="container">
  <h1>Grade Calc Ultra</h1>
  <button id="settingsBtn">⚙️</button>
  <div id="settingsPanel">
    <button id="themeBtn">Toggle Theme</button>
    <button id="exportBtn">Export CSV</button>
    <button id="importBtn">Import CSV</button>
  </div>
  <div class="flex-row">
    <button id="addRowBtn" class="add-btn">+ Add Grade</button>
  </div>
  <div class="grades" id="gradesList"></div>
  <div class="result" id="result">
    <div class="num" id="avgNum">0.00</div>
    <div class="letter" id="letterGrade">–</div>
    <div class="meter"><div class="fill" id="gradeMeter"></div></div>
  </div>
  <input type="file" id="fileInput" accept=".csv"/>
</div>

<script>
const gradesList=document.getElementById('gradesList');
const addRowBtn=document.getElementById('addRowBtn');
const avgNum=document.getElementById('avgNum');
const letterGrade=document.getElementById('letterGrade');
const gradeMeter=document.getElementById('gradeMeter');
const exportBtn=document.getElementById('exportBtn');
const importBtn=document.getElementById('importBtn');
const fileInput=document.getElementById('fileInput');
const themeBtn=document.getElementById('themeBtn');
const settingsBtn=document.getElementById('settingsBtn');
const settingsPanel=document.getElementById('settingsPanel');

let darkMode=true;
const gradingChart=[
  {grade:"A",min:3.6,max:4.0},{grade:"A-",min:3.31,max:3.6},{grade:"B+",min:3.01,max:3.31},
  {grade:"B",min:2.71,max:3.01},{grade:"B-",min:2.31,max:2.71},{grade:"C+",min:2.01,max:2.31},
  {grade:"C",min:1.71,max:2.01},{grade:"C-",min:1.31,max:1.71},{grade:"D",min:1,max:1.31},{grade:"F",min:0,max:1}
];

function letterToNum(letter){if(!letter) return null; letter=String(letter).trim().toUpperCase(); const found=gradingChart.find(g=>g.grade===letter); return found?(found.min+found.max)/2:null;}
function numToLetter(num){const found=gradingChart.find(g=>num>=g.min && num<g.max); return found?found.grade:"A";}
function getColor(num){if(num>=2.71) return 'var(--good)'; if(num>=1.71) return 'var(--warn)'; return 'var(--bad)';}

// Fixed createInputRow to avoid [object MouseEvent]
function createInputRow(val=''){
  if(val instanceof Event) val=''; // Ignore event object
  const row=document.createElement('div'); row.className='grade-row'; row.draggable=true;
  const inputContainer=document.createElement('div'); inputContainer.className='grade-inputs';
  const inp=document.createElement('input'); inp.type='text'; inp.placeholder='Enter grade'; inp.value=val;
  const removeBtn=document.createElement('button'); removeBtn.textContent='X'; removeBtn.className='remove-btn';
  removeBtn.addEventListener('click',()=>{row.style.opacity='0'; row.style.transform='scale(0.8)'; setTimeout(()=>{row.remove(); calculate();},200);});
  inputContainer.appendChild(inp); inputContainer.appendChild(removeBtn);
  const sugg=document.createElement('div'); sugg.className='suggestion';
  const bar=document.createElement('div'); bar.className='grade-bar'; const barFill=document.createElement('div'); barFill.className='grade-bar-fill'; bar.appendChild(barFill);
  inp.addEventListener('input',()=>{updateBar(inp,barFill,sugg); calculate(true);});
  row.appendChild(inputContainer); row.appendChild(sugg); row.appendChild(bar);
  gradesList.appendChild(row); setTimeout(()=>row.classList.add('show'),50); inp.focus();
  row.addEventListener('dragstart',()=>{row.classList.add('dragging');});
  row.addEventListener('dragend',()=>{row.classList.remove('dragging');});
  updateBar(inp,barFill,sugg);
}

function updateBar(inp,barFill,sugg){
  const val=inp.value.trim(); let num=parseFloat(val);
  if(isNaN(num)){const n=letterToNum(val); sugg.textContent=n!==null?`≈ ${n.toFixed(2)}`:''; barFill.style.width=n!==null?(n/4*100)+'%':'0%'; barFill.style.background=getColor(n);}
  else{const letter=numToLetter(num); sugg.textContent=`≈ ${letter}`; barFill.style.width=(num/4*100)+'%'; barFill.style.background=getColor(num);}
}

function calculate(animate=false){
  const inputs=gradesList.querySelectorAll('input'); let total=0,count=0;
  inputs.forEach(i=>{const val=i.value.trim(); if(!val) return; let num=parseFloat(val); if(isNaN(num)) num=letterToNum(val); if(num!==null){total+=num; count++;}});
  if(count===0){avgNum.textContent='0.00'; letterGrade.textContent='–'; gradeMeter.style.width='0%'; gradeMeter.style.background='var(--bad)'; return;}
  const avg=total/count; avgNum.textContent=avg.toFixed(2); letterGrade.textContent=numToLetter(avg); gradeMeter.style.width=(avg/4*100)+'%'; gradeMeter.style.background=getColor(avg);
  if(animate){avgNum.classList.remove('animate'); void avgNum.offsetWidth; avgNum.classList.add('animate');}
}

gradesList.addEventListener('dragover',e=>{e.preventDefault(); const dragging=document.querySelector('.dragging'); const afterElement=[...gradesList.querySelectorAll('.grade-row:not(.dragging)')].reduce((closest,child)=>{const box=child.getBoundingClientRect(); const offset=e.clientY-box.top-box.height/2; if(offset<0 && offset>closest.offset) return {offset:offset, element:child}; return closest;},{offset:Number.NEGATIVE_INFINITY}).element; if(afterElement) gradesList.insertBefore(dragging,afterElement); else gradesList.appendChild(dragging); calculate();});

// Settings toggle
settingsBtn.addEventListener('click',()=>{settingsPanel.style.display=settingsPanel.style.display==='flex'?'none':'flex'; settingsPanel.style.flexDirection='column';});

// Theme toggle
themeBtn.addEventListener('click',()=>{darkMode=!darkMode; document.body.classList.toggle('light',!darkMode);});

// CSV Export
exportBtn.addEventListener('click',()=>{const values=[...gradesList.querySelectorAll('input')].map(i=>i.value.trim()); const csv="data:text/csv;charset=utf-8,"+values.join(","); const encoded=encodeURI(csv); const link=document.createElement('a'); link.setAttribute('href',encoded); link.setAttribute('download','grades.csv'); document.body.appendChild(link); link.click(); link.remove();});

// CSV Import
importBtn.addEventListener('click',()=>{fileInput.click();});
fileInput.addEventListener('change',(e)=>{const file=e.target.files[0]; if(!file) return; const reader=new FileReader(); reader.onload=()=>{ const text=reader.result; const values=text.split(","); gradesList.innerHTML=''; values.forEach(v=>createInputRow(v)); calculate(true); }; reader.readAsText(file);});

// Initial
createInputRow(); addRowBtn.addEventListener('click',createInputRow);
</script>
</body>
</html>
