<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Grade Calculator</title>
<style>
:root{
  --bg-dark:#0d1117;
  --bg-light:#f7f7f9;
  --card-dark:rgba(22,27,35,0.95);
  --card-light:rgba(255,255,255,0.95);
  --accent1:#6a7cff;
  --accent2:#3dd6c6;
  --good:#6fe3b6;
  --warn:#ffbe5b;
  --bad:#ff7d7d;
  --text-dark:#e8eef3;
  --text-light:#111;
  --muted-dark:#8a93a2;
  --muted-light:#555;
  --shadow-dark:0 20px 40px rgba(0,0,0,0.5);
  --shadow-light:0 20px 40px rgba(0,0,0,0.15);
  --transition:0.35s ease;
  font-family:"Inter","Segoe UI",Roboto,sans-serif;
}

/* Body & Theme */
body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:40px 20px;
  background:linear-gradient(135deg,#0d1117,#12151c);
  color:var(--text-dark);
  transition:background var(--transition), color var(--transition);
}

body.light{
  background:#f7f7f9;
  color:var(--text-light);
}

/* Container & Card */
.container{
  width:100%;
  max-width:720px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:20px;
}

.card{
  width:100%;
  background:var(--card-dark);
  backdrop-filter:blur(15px);
  border-radius:25px;
  padding:30px 25px;
  box-shadow:var(--shadow-dark);
  display:flex;
  flex-direction:column;
  gap:20px;
  position:relative;
}

body.light .card{
  background:var(--card-light);
  box-shadow:var(--shadow-light);
}

/* Header */
h1{
  font-size:2.8rem;
  font-weight:800;
  margin:0;
  text-align:center;
  background:linear-gradient(90deg,var(--accent1),var(--accent2));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

/* Help overlay */
.help-overlay{
  background:rgba(255,255,255,0.1);
  padding:12px 18px;
  border-radius:20px;
  color:var(--text-dark);
  font-size:14px;
  text-align:center;
  width:100%;
  box-shadow:0 5px 15px rgba(0,0,0,0.25);
  transition:all 0.3s ease;
}

body.light .help-overlay{
  background:rgba(255,255,255,0.85);
  color:var(--text-light);
}

/* Grades list */
.grades{
  display:flex;
  flex-direction:column;
  gap:12px;
  width:100%;
}

/* Grade row */
.grade-row{
  display:flex;
  flex-direction:column;
  gap:6px;
  cursor:grab;
  user-select:none;
  opacity:0;
  transform:scale(0.95);
  transition:all 0.3s ease;
}
.grade-row.show{
  opacity:1;
  transform:scale(1);
}
.grade-row.dragging{
  opacity:0.7;
  transform:scale(1.03);
  box-shadow:0 10px 25px rgba(0,0,0,0.4);
}

/* Inputs */
.grade-inputs{
  display:flex;
  gap:10px;
  width:100%;
}
.grade-row input{
  flex:1;
  padding:12px 16px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,0.1);
  background:rgba(255,255,255,0.05);
  color:var(--text-dark);
  font-size:15px;
  transition:all 0.3s ease;
}
body.light .grade-row input{color:var(--text-light);}
.grade-row input:focus{
  outline:none;
  border-color:var(--accent1);
  background:rgba(255,255,255,0.12);
  box-shadow:0 0 12px rgba(106,124,255,0.25);
}

/* Remove button */
.remove-btn{
  padding:6px 14px;
  font-size:13px;
  background:var(--bad);
  color:#fff;
  border-radius:18px;
  border:none;
  cursor:pointer;
  transition:all 0.25s ease;
}
.remove-btn:hover{transform:scale(1.1); opacity:0.9;}

/* Suggestion under input */
.suggestion{
  font-size:12px;
  color:var(--muted-dark);
  text-align:right;
}
body.light .suggestion{color:var(--muted-light);}

/* Grade bar */
.grade-bar{
  width:100%;
  height:12px;
  border-radius:10px;
  background:rgba(255,255,255,0.05);
  overflow:hidden;
}
.grade-bar-fill{
  height:100%;
  width:0%;
  border-radius:10px;
  transition:width 0.5s ease, background 0.4s ease;
}

/* Result */
.result{
  text-align:center;
  padding:20px;
  border-radius:20px;
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.08);
  box-shadow:0 10px 30px rgba(0,0,0,0.35);
  display:flex;
  flex-direction:column;
  gap:10px;
}
.result .num{
  font-size:2.5rem;
  font-weight:700;
  background:linear-gradient(90deg,var(--accent1),var(--accent2));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.result .letter{
  font-size:1.8rem;
  font-weight:600;
}

/* Add button */
button.add-btn{
  padding:12px 18px;
  font-size:16px;
  border-radius:22px;
  background:linear-gradient(90deg,var(--accent1),var(--accent2));
  color:#071027;
  font-weight:600;
  border:none;
  cursor:pointer;
  transition:all 0.3s ease;
}
button.add-btn:hover{transform:scale(1.05); box-shadow:0 0 15px rgba(106,124,255,0.4);}

/* Settings panel */
#settingsBtn{
  position:absolute;
  top:20px;
  right:20px;
  background:var(--accent2);
  color:#071027;
  border:none;
  padding:8px 10px;
  border-radius:16px;
  cursor:pointer;
}
#settingsPanel{
  position:absolute;
  top:60px;
  right:20px;
  background:var(--card-dark);
  padding:15px;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,0.4);
  display:none;
  flex-direction:column;
  gap:10px;
  min-width:180px;
  z-index:10;
}
body.light #settingsPanel{background:var(--card-light);}
#settingsPanel button{
  padding:8px 12px;
  border-radius:16px;
  border:none;
  cursor:pointer;
  font-size:14px;
}
#settingsPanel button:hover{transform:scale(1.05);}
input[type="file"]{display:none;}

/* Responsive */
@media(max-width:600px){
  h1{font-size:2rem;}
  .grade-row input{font-size:14px;padding:10px 12px;}
  .remove-btn{font-size:12px;padding:5px 10px;}
  .result .num{font-size:2rem;}
  .result .letter{font-size:1.5rem;}
  button.add-btn{font-size:14px;padding:10px 14px;}
}
</style>
</head>
<body>
<div class="container">
  <h1>Smart Grade Calculator</h1>
  <div class="help-overlay" id="helpOverlay">Enter your mastery levels to calculate your average.</div>
  <button id="settingsBtn">⚙️</button>
  <div id="settingsPanel">
    <button id="themeBtn">Toggle Theme</button>
    <button id="exportBtn">Export CSV</button>
    <button id="importBtn">Import CSV</button>
    <button id="resetBtn">Reset Data</button>
  </div>
  <div class="card">
    <button id="addRowBtn" class="add-btn">+ Add Grade</button>
    <div class="grades" id="gradesList"></div>
    <div class="result" id="result">
      <div class="num" id="avgNum">0.00</div>
      <div class="letter" id="letterGrade">–</div>
      <div class="grade-bar"><div class="grade-bar-fill" id="gradeMeter"></div></div>
    </div>
    <input type="file" id="fileInput" accept=".csv"/>
  </div>
</div>

<script>
// --- Variables ---
const gradesList = document.getElementById('gradesList');
const addRowBtn = document.getElementById('addRowBtn');
const avgNum = document.getElementById('avgNum');
const letterGrade = document.getElementById('letterGrade');
const gradeMeter = document.getElementById('gradeMeter');
const helpOverlay = document.getElementById('helpOverlay');
const themeBtn = document.getElementById('themeBtn');
const settingsBtn = document.getElementById('settingsBtn');
const settingsPanel = document.getElementById('settingsPanel');
const exportBtn = document.getElementById('exportBtn');
const importBtn = document.getElementById('importBtn');
const fileInput = document.getElementById('fileInput');
const resetBtn = document.getElementById('resetBtn');

let darkMode = true;
const gradingChart = [
  {grade:"A",min:3.6,max:4.0},{grade:"A-",min:3.31,max:3.6},{grade:"B+",min:3.01,max:3.31},
  {grade:"B",min:2.71,max:3.01},{grade:"B-",min:2.31,max:2.71},{grade:"C+",min:2.01,max:2.31},
  {grade:"C",min:1.71,max:2.01},{grade:"C-",min:1.31,max:1.71},{grade:"D",min:1,max:1.31},{grade:"F",min:0,max:1}
];

// --- Functions ---
function letterToNum(letter){if(!letter)return null;letter=letter.trim().toUpperCase();const g=gradingChart.find(g=>g.grade===letter);return g?(g.min+g.max)/2:null;}
function numToLetter(num){const g=gradingChart.find(g=>num>=g.min && num<g.max);return g?g.grade:"A";}
function getColor(num){return num>=2.71?'var(--good)':num>=1.71?'var(--warn)':'var(--bad)';}

// Create row
function createRow(val=''){
  const row = document.createElement('div'); row.className='grade-row'; row.draggable=true;
  const container = document.createElement('div'); container.className='grade-inputs';
  const inp = document.createElement('input'); inp.placeholder='Enter grade'; inp.value=val;
  const remove = document.createElement('button'); remove.className='remove-btn'; remove.textContent='X';
  remove.onclick = ()=>{row.remove(); calculate(true); updateHelp(); saveGrades();}
  container.append(inp, remove);
  const sugg = document.createElement('div'); sugg.className='suggestion';
  const bar = document.createElement('div'); bar.className='grade-bar'; const fill = document.createElement('div'); fill.className='grade-bar-fill'; bar.appendChild(fill);
  inp.oninput = ()=>{updateBar(inp,fill,sugg); calculate(true); updateHelp(); saveGrades();}
  row.append(container,sugg,bar); gradesList.appendChild(row); setTimeout(()=>row.classList.add('show'),50);
  inp.focus();
  row.ondragstart = ()=>row.classList.add('dragging'); row.ondragend = ()=>row.classList.remove('dragging');
  updateBar(inp,fill,sugg);
}

// Update bar
function updateBar(inp,fill,sugg){
  const val = inp.value.trim(); let num = parseFloat(val);
  if(isNaN(num)){const n=letterToNum(val); sugg.textContent=n!==null?`≈ ${n.toFixed(2)}`:''; fill.style.width=n!==null?(n/4*100)+'%':'0%'; fill.style.background=getColor(n);}
  else{const letter=numToLetter(num); sugg.textContent=`≈ ${letter}`; fill.style.width=(num/4*100)+'%'; fill.style.background=getColor(num);}
}

// Calculate average
function calculate(animate=false){
  const inputs=[...gradesList.querySelectorAll('input')]; let total=0,count=0;
  inputs.forEach(i=>{const val=i.value.trim(); if(!val)return; let num=parseFloat(val); if(isNaN(num)) num=letterToNum(val); if(num!==null){total+=num; count++;}});
  if(count===0){avgNum.textContent='0.00'; letterGrade.textContent='–'; gradeMeter.style.width='0%'; gradeMeter.style.background='var(--bad)'; return;}
  const avg=total/count; avgNum.textContent=avg.toFixed(2); letterGrade.textContent=numToLetter(avg); gradeMeter.style.width=(avg/4*100)+'%'; gradeMeter.style.background=getColor(avg);
  if(animate){avgNum.classList.remove('animate'); void avgNum.offsetWidth; avgNum.classList.add('animate');}
}

// Update help overlay
function updateHelp(){
  const inputs=[...gradesList.querySelectorAll('input')];
  const empty=inputs.filter(i=>!i.value.trim()).length;
  const low=inputs.filter(i=>{const n=parseFloat(i.value)||letterToNum(i.value); return n!==null && n<2.0;}).length;
  if(empty>0) helpOverlay.textContent=`Fill ${empty} missing mastery levels for accurate average!`;
  else if(low>0) helpOverlay.textContent=`Heads up: ${low} low scores. Focus to improve!`;
  else helpOverlay.textContent=`Great job! All grades entered.`;
}

// Drag & drop
gradesList.addEventListener('dragover',e=>{
  e.preventDefault();
  const dragging=document.querySelector('.dragging');
  const after=[...gradesList.querySelectorAll('.grade-row:not(.dragging)')].reduce((closest,child)=>{
    const box=child.getBoundingClientRect(); const offset=e.clientY-box.top-box.height/2;
    if(offset<0 && offset>closest.offset) return {offset:offset,element:child}; return closest;
  },{offset:Number.NEGATIVE_INFINITY}).element;
  if(after) gradesList.insertBefore(dragging,after); else gradesList.appendChild(dragging);
  calculate(true); updateHelp(); saveGrades();
});

// Settings
settingsBtn.onclick=()=>{settingsPanel.style.display=settingsPanel.style.display==='flex'?'none':'flex'; settingsPanel.style.flexDirection='column';}
themeBtn.onclick=()=>{darkMode=!darkMode; document.body.classList.toggle('light',!darkMode);}
resetBtn.onclick=()=>{localStorage.removeItem('grades'); gradesList.innerHTML=''; createRow(); calculate(true); updateHelp();}
exportBtn.onclick=()=>{const vals=[...gradesList.querySelectorAll('input')].map(i=>i.value.trim()); const csv="data:text/csv;charset=utf-8,"+vals.join(","); const link=document.createElement('a'); link.href=encodeURI(csv); link.download='grades.csv'; document.body.appendChild(link); link.click(); link.remove();}
importBtn.onclick=()=>{fileInput.click();}
fileInput.onchange=(e)=>{const file=e.target.files[0]; if(!file) return; const reader=new FileReader(); reader.onload=()=>{const vals=reader.result.split(","); gradesList.innerHTML=''; vals.forEach(v=>createRow(v)); calculate(true); updateHelp(); saveGrades();}; reader.readAsText(file);}

// Persistent storage
function saveGrades(){const vals=[...gradesList.querySelectorAll('input')].map(i=>i.value.trim()); localStorage.setItem('grades',JSON.stringify(vals));}
function loadGrades(){const vals=JSON.parse(localStorage.getItem('grades')||'[]'); gradesList.innerHTML=''; if(vals.length){vals.forEach(v=>createRow(v)); calculate(true); updateHelp();} else createRow();}

// Init
loadGrades(); addRowBtn.onclick=()=>{createRow(); updateHelp(); saveGrades();}
</script>
</body>
</html>
